<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order Management</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/order-management.css" />
  <style>
      .btn-icon {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 40px;
          height: 40px;
          padding: 0;
          border: 1px solid var(--border);
          background-color: transparent;
          color: var(--muted);
          border-radius: 10px;
          cursor: pointer;
          transition: all 0.2s;
      }
      .btn-icon:hover {
          border-color: var(--accent);
          color: var(--accent);
          background-color: var(--accent-light);
      }
      .form-header {
        gap: 16px;
      }
      .header-group-left {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-right: auto;
      }
       .header-group-right {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      /* ++ CSS แก้ไขปุ่ม + ++ */
      #btn-new-order {
        padding: 0;
        width: 40px;
      }
  </style>
</head>
<body>

<div class="wrap">
  <main class="stack">
    <section class="card">
      <header class="form-header">
        <div class="header-group-left">
          <h1 id="form-title" class="brand">Order Management</h1>
        </div>
        <div class="header-group-right">
          <a href="/admin/home" class="btn-icon" title="Back to Home">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M10.354 4.646a.5.5 0 0 1 0 .708L6.707 8l3.647 3.646a.5.5 0 0 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 0 1 .708 0z"></path></svg>
          </a>
          <button id="btn-new-order" class="btn ghost">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
          </button>
        </div>
      </header>

      <form id="order-form" class="stack" data-mode="new">
        <input type="hidden" id="editing-order-id" />

        <div class="form-section">
          <div class="grid g12">
            <div class="field col-6">
              <label for="game-select" class="field-label">เกม</label>
              <select id="game-select" class="input"></select>
            </div>
            <div class="field col-6">
              <label for="platform" class="field-label">แพลตฟอร์ม</label>
              <select id="platform" class="input"></select>
            </div>
          </div>
          <div class="add-item-row">
            <select id="add-item-package" class="input" disabled></select>
            <input type="number" min="1" value="1" id="add-item-qty" class="input" placeholder="จำนวน" />
            <input type="number" min="0" step="0.01" id="add-item-unit" class="input" placeholder="ราคา/หน่วย" />
            <button id="btn-add-item" type="button" class="btn primary icon-btn" title="เพิ่มรายการ">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            </button>
          </div>
          <div class="table-wrap">
            <table id="items-table" class="table">
              <thead><tr><th>แพ็กเกจ</th><th>จำนวน</th><th class="num">ราคา/หน่วย</th><th class="num">รวม</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        
        <div class="form-section">
          <div class="grid g3">
            <div class="field">
              <label for="customer-name" class="field-label">ชื่อลูกค้า</label>
              <input type="text" id="customer-name" class="input" />
            </div>
            <div class="field">
              <label for="operator" class="field-label">ผู้ทำรายการ</label>
              <select id="operator" class="input">
                  <option>แทน</option>
                  <option>แอดมิน A</option>
                  <option>แอดมิน B</option>
              </select>
            </div>
            <div class="field">
              <label for="order-date" class="field-label">วันที่ทำรายการ</label>
              <input type="date" id="order-date" class="input" />
            </div>
          </div>
        </div>

        <div class="form-section">
          <div class="grid g3 compact">
            <div class="field">
              <label for="total-paid" class="field-label">ยอดจ่าย (รวม)</label>
              <input type="number" min="0" step="0.01" id="total-paid" class="input" />
            </div>
            <div class="field">
              <label for="cost" class="field-label">ต้นทุน (รวม)</label>
              <input type="number" min="0" step="0.01" id="cost" class="input" />
            </div>
            <div class="stat"><small>กำไร</small><strong id="profit">0.00</strong></div>
          </div>
          <div class="grid g2">
            <div class="field">
              <label for="payment-proof" class="field-label">หลักฐานโอนเงิน (URL)</label>
              <input type="url" id="payment-proof" class="input" placeholder="กรอกลิงก์ที่ได้จากโปรแกรม" />
            </div>
            <div class="field">
              <label for="sales-proof" class="field-label">หลักฐานปิดการขาย (URL)</label>
              <input type="url" id="sales-proof" class="input" placeholder="กรอกลิงก์ที่ได้จากโปรแกรม" />
            </div>
          </div>
          <div class="grid g12">
             <div class="field col-6">
               <label for="topup-channel" class="field-label">ช่องทางการเติม</label>
               <select id="topup-channel" class="input"></select>
             </div>
             <div class="field col-6">
               <label for="status" class="field-label">สถานะ</label>
               <select id="status" class="input"></select>
             </div>
          </div>
          <div class="field">
            <label for="note" class="field-label">หมายเหตุ</label>
            <textarea id="note" rows="4" class="input"></textarea>
          </div>
        </div>

        <footer class="form-footer">
          <button id="btn-save" class="btn primary">บันทึกออเดอร์</button>
          <span id="save-result" class="muted"></span>
        </footer>
      </form>
    </section>

    <section class="card">
      <header class="topbar">
        <h1>รายการออเดอร์</h1>
        <div class="actions">
          <button id="btn-export-csv" class="btn">
             <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            <span>Export CSV</span>
          </button>
          <button id="btn-refresh" class="btn ghost icon-btn">⟲</button>
        </div>
      </header>
      <div class="grid g12 compact" style="margin-top: 16px;">
        <div class="field col-6">
          <label for="search-q" class="field-label">ค้นหา</label>
          <input type="search" id="search-q" class="input" placeholder="เลขออเดอร์, ชื่อลูกค้า..." />
        </div>
        <div class="field col-3">
          <label for="filter-status" class="field-label">สถานะ</label>
          <select id="filter-status" class="input"></select>
        </div>
        <div class="field col-3">
          <label for="filter-platform" class="field-label">แพลตฟอร์ม</label>
          <select id="filter-platform" class="input"></select>
        </div>
      </div>
      <div class="table-wrap">
        <table id="orders-table" class="table sticky">
          <thead><tr>
            <th>เลขออเดอร์</th><th>วันที่</th><th>ลูกค้า</th><th>เกม</th>
            <th class="num">ยอดจ่าย</th><th class="num">กำไร</th><th>สถานะ</th><th>ผู้ทำรายการ</th>
            <th></th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>
</div>

<div id="custom-dialog-overlay" class="dialog-overlay">
  <div id="custom-dialog-box" class="dialog-box">
    <h3 id="dialog-title" class="dialog-title">ยืนยันการกระทำ</h3>
    <p id="dialog-message" class="dialog-message">คุณแน่ใจหรือไม่?</p>
    <div id="dialog-buttons" class="dialog-buttons"></div>
  </div>
</div>

<script src="/order-management.js"></script>
</body>
</html>